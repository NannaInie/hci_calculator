<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carbon Footprint Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #f4f4f4;
        }

        .calculator-container {
            width: 90%;
            max-width: 600px;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        input, select {
            width: calc(100% - 20px);
            padding: 8px;
            margin: 5px 0 10px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            padding: 10px 20px;
            background-color: #007BFF;
            border: none;
            border-radius: 4px;
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        #jobs-list {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background-color: #f9f9f9;
        }

        .job-item {
            margin-bottom: 20px;
            padding: 10px;
            background-color: #e9ecef;
            border-radius: 4px;
            font-size: 0.8em;
        }

        #result {
            margin-top: 20px;
            padding: 15px;
            border: 2px solid #28a745;
            border-radius: 4px;
            background-color: #d4edda;
            color: #155724;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <h1>HCI GenAI CO2st Calculator</h1>

        <div class="form-group">
            <label for="use-case">Select Research Phase:</label>
            <select id="use-case" required>
                <option value="research-planning">Research & Planning</option>
                <option value="prototyping-building">Prototyping & Building</option>
                <option value="evaluation-user-studies">Evaluation & User Studies</option>
                <option value="data-collection">Data Collection</option>
                <option value="analysis-synthesis">Analysis & Synthesis</option>
                <option value="dissemination-communication">Dissemination & Communication</option>
                <option value="training-fine-tuning">Training & Fine-tuning</option>
            </select>
        </div>

        <div class="form-group">
            <label for="specific-task">Select Type of Use:</label>
            <select id="specific-task" required>
                <!-- Task options will be dynamically populated -->
            </select>
        </div>

        <div class="form-group">
            <label for="specific-model">Select Type of Model:</label>
            <select id="specific-model" required>
                <!-- Model options will be dynamically populated -->
            </select>
        </div>
        
        <div id="dynamic-parameters"></div>

        <button id="add-job">Add Use Case</button>
        <div id="jobs-list"></div>

        <button id="calculate">Calculate Total Carbon Footprint</button>
        <div id="result"></div>
    </div>
    
    <script>
        const jobs = [];

const taskParameters = {
    "literature-review-or-search": [
        { id: "num-papers", label: "Number of Papers Reviewed", type: "number", min: 0, default: 1 }
    ],
    "generation-of-materials-for-user-study": [
        { id: "avg-len", label: "Average length of prompts (in words)", type: "number", min: 0, default: 100 },
        { id: "num-prompt", label: "Number of prompts", type: "number", min: 0, default: 1 }
    ],
    "language-model-fine-tuning": [
        { id: "num-epochs", label: "Number of Epochs", type: "number", min: 1 },
        { id: "dataset-size", label: "Dataset Size (GB)", type: "number", min: 0.1, step: 0.1 }
    ]
};

const taskModels = {
    "literature-review-or-search": {
        "Text-to-Text": 0.00468515625
    },
    "generation-of-materials-for-user-study": {
        "Text-to-Text": 0.00468515625,
        "Text-to-Image": 0.0013009765625
    },
    "language-model-fine-tuning": {
        "GPT-3": 2,  // Assign numerical value 2 to GPT-3
        "BERT": 0.2,  // Assign numerical value 0.2 to BERT
        "T5": 1       // Assign numerical value 1 to T5
    }
};

// Define model-specific parameters
const modelSpecificParameters = {
    "GPT-3": {
        "num-parameters": [
            { id: "num-epochs", label: "Number of Epochs", type: "number", min: 1, default: 5 }
        ]
    },
    "BERT": {
        "num-parameters": [
            { id: "batch-size", label: "Batch Size", type: "number", min: 1, default: 32 }
        ]
    }
};

// Function to populate tasks based on selected use case
function populateTasks(useCase) {
    const taskSelect = document.getElementById('specific-task');
    taskSelect.innerHTML = '';  // Clear old options

    let tasks = [];
    switch (useCase) {
        case "research-planning":
            tasks = ["literature-review-or-search", "generation-of-materials-for-user-study"];
            break;
        case "training-fine-tuning":
            tasks = ["language-model-fine-tuning"];
            break;
        // Add more use case conditions as needed
    }

    tasks.forEach(task => {
        const option = document.createElement('option');
        option.value = task;
        option.textContent = task.replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
        taskSelect.appendChild(option);
    });
}

// Function to populate models based on selected task
function populateModels(task) {
    const modelSelect = document.getElementById('specific-model');
    modelSelect.innerHTML = '';  // Clear old options

    let models = [];
    if (taskModels[task]) {
        models = Object.keys(taskModels[task]);
    }

    models.forEach(model => {
        const option = document.createElement('option');
        option.value = model;
        option.textContent = model;
        modelSelect.appendChild(option);
    });
}

// Function to populate model-specific parameters based on selected model
function populateModelSpecificParameters(model) {
    const dynamicParamsDiv = document.getElementById('dynamic-parameters');
    dynamicParamsDiv.innerHTML = '';  // Clear old parameters

    if (modelSpecificParameters[model]) {
        modelSpecificParameters[model].num-parameters.forEach(param => {
            const paramDiv = document.createElement('div');
            paramDiv.classList.add('form-group');

            const label = document.createElement('label');
            label.htmlFor = param.id;
            label.textContent = param.label;

            const input = document.createElement('input');
            input.id = param.id;
            input.type = param.type;
            input.min = param.min;
            input.value = param.default;

            paramDiv.appendChild(label);
            paramDiv.appendChild(input);
            dynamicParamsDiv.appendChild(paramDiv);
        });
    }
}

// Event listener for use case change
document.getElementById('use-case').addEventListener('change', function () {
    const selectedUseCase = this.value;
    populateTasks(selectedUseCase);
    populateModels(document.getElementById('specific-task').value);  // Populate models for the default task
    populateModelSpecificParameters(document.getElementById('specific-model').value);  // Populate model-specific parameters
});

// Event listener for task change
document.getElementById('specific-task').addEventListener('change', function () {
    const selectedTask = this.value;
    populateModels(selectedTask);
    populateModelSpecificParameters(document.getElementById('specific-model').value);  // Populate model-specific parameters for selected task
});

// Event listener for model change
document.getElementById('specific-model').addEventListener('change', function () {
    const selectedModel = this.value;
    populateModelSpecificParameters(selectedModel);  // Populate model-specific parameters for selected model
});

// Initialize the dropdowns on page load
document.addEventListener('DOMContentLoaded', function () {
    const initialUseCase = document.getElementById('use-case').value;
    populateTasks(initialUseCase);
    populateModels(document.getElementById('specific-task').value);  // Populate models for the default task
    populateModelSpecificParameters(document.getElementById('specific-model').value);  // Populate model-specific parameters
});

        document.getElementById('add-job').addEventListener('click', function () {
            const useCase = document.getElementById('use-case').value;
            const specificTask = document.getElementById('specific-task').value;
            const specificModel = document.getElementById('specific-model').value;
            const modelValue = taskModels[specificTask] ? taskModels[specificTask][specificModel] : 1;

            const carbonIntensity = 0.481;
            const powerUsage = 1.58;

            const dynamicParamsDiv = document.getElementById('dynamic-parameters');
            const additionalParams = {};
            Array.from(dynamicParamsDiv.querySelectorAll('input')).forEach(input => {
                if (input.type === 'number' || input.type === 'range') {
                    additionalParams[input.id] = parseFloat(input.value);
                }
            });

            let additionalFactor = 1;
            Object.values(additionalParams).forEach(value => {
                additionalFactor += value / 100;
            });

            const carbonFootprint = carbonIntensity * powerUsage * additionalFactor * modelValue;

            const job = {
                useCase: `${useCase} #${jobs.length + 1}`,
                specificTask,
                specificModel,
                carbonIntensity,
                powerUsage,
                carbonFootprint
            };

            jobs.push(job);

            const jobsList = document.getElementById('jobs-list');
            const jobItem = document.createElement('div');
            jobItem.classList.add('job-item');
            jobItem.innerHTML = `
                Use Case: ${useCase}, Task: ${job.specificTask.replace(/-/g, ' ').replace(/\b\w/g, c => c.toUpperCase())},
                Model: ${job.specificModel}, Carbon Footprint: ${carbonFootprint.toFixed(5)} kgCO2e
            `;
            jobsList.appendChild(jobItem);
        });

        document.getElementById('calculate').addEventListener('click', function () {
            let totalFootprint = 0;

            jobs.forEach(job => {
                totalFootprint += job.carbonFootprint;
            });

            const resultDiv = document.getElementById('result');
            resultDiv.textContent = `Total Carbon Footprint: ${totalFootprint.toFixed(5)} kgCO2e`;
        });

        // Populate dropdowns on page load
        window.onload = function() {
            const useCase = document.getElementById('use-case').value;
            populateSpecificTasks(useCase);
        };
    </script>
</body>
</html>
